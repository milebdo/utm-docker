input {
  # HTTP input for receiving logs
  http {
    port => 9600
    codec => json
  }
  
  # Syslog input
  syslog {
    port => 5044
    type => "syslog"
  }
  
  # TCP input for various log sources
  tcp {
    port => 5000
    codec => json
    type => "tcp_logs"
  }
}

filter {
  # Add timestamp if not present
  if ![@timestamp] {
    date {
      match => [ "timestamp", "ISO8601", "UNIX", "UNIX_MS" ]
      target => "@timestamp"
    }
  }
  
  # Add host information
  if ![host] {
    mutate {
      add_field => { "host" => "%{host}" }
    }
  }
  
  # Basic log parsing
  if [message] {
    grok {
      match => { "message" => "%{GREEDYDATA:log_message}" }
    }
  }
}

output {
  # Output to OpenSearch
  elasticsearch {
    hosts => ["opensearch:9200"]
    index => "utmstack-logs-%{+YYYY.MM.dd}"
    ssl => false
    ssl_certificate_verification => false
  }
  
  # Console output for debugging (remove in production)
  stdout {
    codec => rubydebug
  }
}
